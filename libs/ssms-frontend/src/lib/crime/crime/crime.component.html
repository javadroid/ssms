

    <!-- CASE MANAGEMENT ================ CASE MANAGEMENT ========= CASE MANAGEMENT -->
    <div class="case_management">

        <ssms-crime-header
        (searchEmit)="onSearch($event)"
        ></ssms-crime-header>

      <!-- CASE PREVIEW AFTER SEARCH HAS BEEN MADE =========== CASE PREVIEW AFTER SEARCH HAS BEEN MADE -->

      <div class="case_preview " *ngIf="crimeSearch">
        <div class="section">
          <h1> <span  (click)="crimeSearch=!crimeSearch" class="status btn-warning ">Back</span></h1>
          <h1 class="crime_type">{{crime?.crimeType}} <span class="status">{{crime?.status}}</span></h1>
          <div class="sub_info d-flex">
            <p class="crime_info">Offense date: <span>{{crime?.crimeDate}}</span></p>
            <p class="crime_info">Offense Time: <span>{{crime?.crimeTime}}</span></p>
            <p class="crime_info">Last Updated Time: <span>10:15 PM</span></p>
            <!-- <p class="crime_info">Closed on: <span>20/12/2022</span></p> -->
            <p class="crime_info">Officer Assigned: <span>{{personnelData[0].lastname+" "+personnelData[0].firstname }}</span></p>
          <button *ngIf="crime.status==='ACTIVE'" (dblclick)="closeCase()" class="btn btn-danger">Close Case</button>
          <button *ngIf="crime.status==='CLOSED'" (dblclick)="openCase()" class="btn btn-danger">Reopen Case</button>
          </div>
          <p class="statement">
            Statement: <button  *ngIf="crime.status==='ACTIVE'"(click)=" isStatementUpdate=!isStatementUpdate"class="btn btn-secondary">Update</button>
          </p>

            <div class="org_info" >
          <textarea
          cols="70"
          style="overflow:scroll;  width: 100%;"
          rows="20" class="d-block"
          disabled [innerHTML]="crime?.statementOfOffense"></textarea>
        </div>
      </div>


        <div class="section">
          <h4 class="section_title">Suspect and Accomplice(s): <button *ngIf="crime.status==='ACTIVE'" (click)=" isSuspect=!isSuspect" class="btn btn-secondary">Update</button></h4>

          <div *ngFor="let i of criminal" class="suspect_list">
            <div class="suspect">
              <img [src]="i.image" alt="" class="sus_img" />
              <p class="name">{{i.firstName+' '+i.lastName}}</p>
            </div>

          </div>
        </div>

        <div class="section">
          <h4 class="section_title">Victim(s): <button *ngIf="crime.status==='ACTIVE'"(click)=" isVictim=!isVictim" class="btn btn-secondary">Update</button></h4>

          <div *ngFor=" let i of victim "class="suspect_list">
            <div class="suspect">
              <img [src]="i.image" alt="" class="sus_img" />
              <p class="name">{{i.firstName+' '+i.lastName}}</p>
            </div>
          </div>
        </div>
        <div class="section">
          <h4 class="section_title">Evidence - Vehicle: <button *ngIf="crime.status==='ACTIVE'"(click)=" isEvidence=!isEvidence" class="btn btn-secondary">Update</button></h4>

          <div  *ngFor=" let i of vehicle " class="vehicle_list">
            <div class="vehicle">
              <p class="vehicle_info">{{i.brand +' ' }}</p>
              <p class="vehicle_info">{{i.modelNo +' ' }} <span> {{i.license }}</span></p>
            </div>
          </div>
        </div>

        <div class="section">
          <h4 class="section_title">Evidence - Weapon: <button *ngIf="crime.status==='ACTIVE'" (click)=" isEvidence=!isEvidence" class="btn btn-secondary">Update</button></h4>

          <div  *ngFor=" let i of weapon" class="vehicle_list">
            <div class="vehicle">
              <p class="vehicle_info">{{i.brand +' ' }}</p>
              <p class="vehicle_info">{{i.modelNo +' ' }} <span> {{i.license }}</span></p>
            </div>
          </div>
        </div>
        <div  class="section">
          <h4   class="section_title">Evidence - Media files: <button *ngIf="crime.status==='ACTIVE'" (click)="isEvidence=!isEvidence" class="btn btn-secondary">Update</button></h4>

          <div *ngFor=" let i of media"class="vehicle_list">
            <div class="vehicle">
              <p class="vehicle_info">{{i.name }}</p>
              <img  [src]="i.image" [alt]="" class="sus_img" />
            </div>
          </div>
        </div>
      </div>

       <!-- CASE LIST BEGINS HERE===========CASE LIST BEGINS HERE -->

  <div class="personnel_list-container" *ngIf="!crimeSearch">
    <div class="filter_section">
      <button class="btn btn-secondary" >
        <img src="images/filter_list_white_24dp.svg" alt="" />...
      </button>


    </div>
    <div class="table-responsive" >
      <table class="table">
        <thead class="table-dark">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Case ID</th>
            <th scope="col">Case Title</th>
            <th scope="col">Case Type</th>
            <!-- <th scope="col">Officer Incharge</th> -->
            <th scope="col">Status</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr (dblclick) ="onSearch(item._id)" *ngFor="let item of crimeDetail; let i = index">
            <th scope="row">{{ i + 1 }}</th>
            <td>{{ item._id }}</td>
            <td>{{ item.crimeTitle }}</td>
            <td>{{ item.crimeType }}</td>
            <!-- <td>{{ item!.personnel.lastname+" "+item!.personnel.firstname}}</td> -->
            <td>{{ item.status}}</td>
            <td>
              <button
                (click)="$event.stopPropagation()"
                class="btn p-0"
                (click)="showmenu(i,item)"
              >
                <img src="../assets/more_vert_black_24dp.svg" alt="" />
              </button>

              <div
                (click)="$event.stopPropagation()"
                class="actions"
                *ngIf="selectindex === i && showfiltercriteria"
              >


              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

   <div *ngIf="isStatementUpdate" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Make Update</h5>
            <button (click)="isStatementUpdate=!isStatementUpdate" type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
          <textarea [formControl]="statement" name="" id="" style="width: 100%; height: 100%;" cols="30" rows="10"></textarea>
          </div>
          <div class="modal-footer">
            <button (click)="statementUpdate()"  type="button" class="btn btn-primary">Save changes</button>
            <button (click)="isStatementUpdate=!isStatementUpdate" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
 <!-- step 2 (criminal/suspect info) -->
    <div *ngIf="isSuspect" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Make Update</h5>
            <button (click)="isSuspect=!isSuspect" type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="contact_information" >
              <div class="search_nin-container d-flex">
                <input
                  class="form-control me-2"
                  type="search"
                  [formControl]="searchSuspect"
                  placeholder="Search with NIN"
                  aria-label="Search"
                />
                <button class="btn btn-outline-success" (click)="onAddSuspect()">
                  Add
                </button>
              </div>

              <div class="criminal_list">
                <ng-container *ngFor="let suspect of suspects">
                  <div class="criminal_card">
                    <button
                      class="btn more_btn"
                      (click)="OpenSuspect(suspect._id)"
                    >
                      <img src="assets/more_vert.jpeg" alt="" class="more" />
                    </button>
                    <ng-container
                      *ngIf="isOpenSuspect && selectedSuspectId === suspect._id"
                    >
                      <div (click)="openSuspect(suspect)" class="more_container">
                        <!-- <button class="btn">Edit</button> -->
                        <button
                          class="btn"
                          (click)="onDeleteSuspect(suspect._id)"
                        >
                          Delete
                        </button>
                      </div>
                    </ng-container>
                    <img [src]="suspect?.image" class="sus_img" [alt]=" suspect?.firstName +' '+suspect?.lastName " />
                    <h5 class="name">{{ suspect?.firstName }} {{ suspect?.lastName }}</h5>
                  </div>
                </ng-container>
              </div>


            </div>
          </div>
          <div class="modal-footer">
            <button (click)="updateSuspect()"  type="button" class="btn btn-primary">Save changes</button>
            <button (click)="isSuspect=!isSuspect" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
<!-- step 3 (Victims info) -->
    <div *ngIf="isVictim" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Make Update</h5>
            <button (click)="isVictim=!isVictim" type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="contact_information" >
              <div class="search_nin-container d-flex">
                <input
                  class="form-control me-2"
                  [formControl]="searchVictim"
                  type="search"
                  placeholder="Search with NIN"
                  aria-label="Search"
                />
                <button class="btn btn-outline-success" (click)="onAddVictim()">
                  Add
                </button>
              </div>

              <div class="criminal_list">
                <ng-container *ngFor="let victim of victims">
                  <div (click)="openSuspect(victim)" class="criminal_card">
                    <button class="btn more_btn" (click)="OpenVictim(victim._id)">
                      <img src="assets/more_vert.jpeg" alt="" class="more" />
                    </button>
                    <ng-container
                      *ngIf="isOpenVictim && selectedVictimId === victim._id"
                    >
                      <div class="more_container">
                        <!-- <button class="btn">Edit</button> -->
                        <button class="btn" (click)="onDeleteVictim(victim._id)">
                          Delete
                        </button>
                      </div>
                    </ng-container>
                    <img [src]="victim.image" class="sus_img" [alt]="victim.firstName+' '+victim.lastName " />
                    <h5 class="name">{{ victim.firstName+' '+victim.lastName }}</h5>
                  </div>
                </ng-container>
              </div>


            </div>

          </div>
          <div class="modal-footer">
            <button (click)="updateVictim()"  type="button" class="btn btn-primary">Save changes</button>
            <button (click)="isVictim=!isVictim" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
 <!-- step 4 (Create Evidence) -->

 <div *ngIf="isEvidence" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Make Update</h5>
        <button (click)="isEvidence=!isEvidence" type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="contact_information" >
          <!-- evidence selection=============evidence selection -->

            <div class="input_container mb-3">
              <label for="" class="d-block">Select item</label>
              <select
                 [formControl]="type"
                (change)="onSelectEvidenceType($event.target)"
              >
                <option value="">Select item</option>
                <option
                  *ngFor="let evidence of evidenceTypes"
                  [value]="evidence?._id"
                >
                  {{ evidence?.name }}
                </option>
              </select>
            </div>

            <!-- describe evidence(based on what was earlier selected) -->
            <div
              class="d-flex w-100 justify-content-between name_container"
              *ngIf="showVehicleDetails"
            >
              <div class="input_container mb-3">
                <label for="" class="d-block">Brand</label>
                <input
                  type="text"
                    [formControl]="brand"
                  class="form-control"
                  placeholder="Brand"
                />
              </div>
              <div class="input_container mb-3">
                <label for="" class="d-block">License</label>
                <input
                  type="text"
                    [formControl]="license"
                  class="form-control"
                  placeholder="License"
                />
              </div>
              <div class="input_container mb-3">
                <label for="" class="d-block">Model No</label>
                <input
                  type="text"
                    [formControl]="modelNo"
                  class="form-control"
                  placeholder="Model No"
                />
              </div>
            </div>

                 <!-- describe evidence(based on what was earlier selected) -->
        <div class="d-flex w-100 justify-content-between name_container" *ngIf="showWeaponDetails">
          <div class="input_container mb-3">
            <label for="" class="d-block">Weapon name</label>
            <input type="text"  [formControl]="brand" class="form-control" placeholder="Weapon name" />
          </div>
          <div class="input_container mb-3">
            <label for="" class="d-block">License</label>
            <input type="text"  [formControl]="license" class="form-control" placeholder="License" />
          </div>
          <div class="input_container mb-3">
            <label for="" class="d-block">Weapon Type</label>
            <input type="text"  [formControl]="modelNo" class="form-control" placeholder="Gun Type" />
          </div>
        </div>
            <div
              class="d-flex w-100 justify-content-between name_container"
              *ngIf="showFileInput"
            >
              <div class="input_container mb-3">
                <label for="" class="d-block">Model No</label>
                <input
                (formdata)="(fileData)"
          (change)="upload($event)"
                  type="file"
                   [formControl]="file"
                  class="form-control"
                />

              </div>
            </div>
            <button
              class="btn btn-primary"
              [disabled]="evidencetype"
              (click)="onAdddEvidence()"
            >
              Save
            </button>

            <div class="evidence_list">
              <div class="evidence" *ngFor="let evidence of evidences  index as i">
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                  (click)="onDeleteEvidence(i)"
                ></button>
                <h4>{{evidence?.name}}:  <p class="vehicle_info">{{ evidence?.brand }}</p> </h4>

                <p class="vehicle_info">
                  {{ evidence?.license }} <span>{{ evidence?.modelNo }}</span>
                </p>
                <img
                [src]="evidence.file"
                *ngIf="evidence.file"
               [alt]="fileName"
                height="200"
                class="passport"
              />
              </div>
              <!-- <div class="evidence">
            <p class="vehicle_info">Glock 17 Gen4 (Pistol)</p>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div> -->
            </div>


        </div>
      </div>
      <div class="modal-footer">
        <button (click)="updateEvidence()"  type="button" class="btn btn-primary">Save changes</button>
        <button (click)="isEvidence=!isEvidence" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
 </div>



  <!-- NOT FOUND ===============NOT FOUND===========NOT FOUND -->
  <div class="case_modal" *ngIf="isOpenNotFoundSuspect">
    <div
      class="case_card d-flex justify-content-center align-items-center flex-column"
    >
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="modal"
        aria-label="Close"
        (click)="closeNotFoundSuspect()"
      ></button>

      <p class="message">
        Suspect not found in database, would you like to save your
        entries to draft while you create this suspect?
      </p>
      <div class="">
        <button class="btn" (click)="closeNotFoundSuspect()">No</button>
        <button class="btn btn-primary" (click)="onProceedToAdd()">
          Yes
        </button>
      </div>
    </div>
  </div>

  <div class="case_modal" *ngIf="isOpenNotFoundVictim">
    <div
      class="case_card d-flex justify-content-center align-items-center flex-column"
    >
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="modal"
        aria-label="Close"
        (click)="closeNotFoundSuspect()"
      ></button>

      <p class="message">
        Victim not found in database, would you like to save your
        entries to draft while you create this suspect?
      </p>
      <div class="">
        <button class="btn" (click)="closeNotFoundSuspect()">No</button>
        <button class="btn btn-primary" (click)="onProceedToAdd()">
          Yes
        </button>
      </div>
    </div>
  </div>


  <div *ngIf="isTransferCase" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Make transfer of case</h5>
          <button (click)="isTransferCase=!isTransferCase" type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="input_container mb-3">
          <label for="" class="d-block">Select personnel to transfer case to...</label>
          <select [formControl]="persenelid">
            <option value="">Select item</option>
            <option *ngFor="let i of PersonnelDetail" [value]="i._id">{{i.lastname+" "+i.firstname}}</option>
          </select>


          </div>
        <!-- <textarea [formControl]="statement" name="" id="" style="width: 100%; height: 100%;" cols="30" rows="10"></textarea> -->
        </div>
        <div class="modal-footer">
          <button (click)="transferCase()"  type="button" class="btn btn-primary">Save changes</button>
          <button (click)="isTransferCase=!isTransferCase" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
    </div>




